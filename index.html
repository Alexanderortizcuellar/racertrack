<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Racers Dashboard Alexander</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/style.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Styles & Chart Color Variables -->
  </head>

  <body class="p-4" data-theme="light">
    <div id="dashboardContainer" class="container">
      <!-- HEADER -->
      <header
        class="d-flex flex-wrap justify-content-between align-items-center mb-5"
      >
        <div>
          <h4 class="dashboard-header mb-0"><svg style="width: 20px; height: 20px;margin-right: 5px;" aria-h idden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M135.2 117.4l-26.1 74.6 293.8 0-26.1-74.6C372.3 104.6 360.2 96 346.6 96L165.4 96c-13.6 0-25.7 8.6-30.2 21.4zM39.6 196.8L74.8 96.3C88.3 57.8 124.6 32 165.4 32l181.2 0c40.8 0 77.1 25.8 90.6 64.3l35.2 100.5c23.2 9.6 39.6 32.5 39.6 59.2l0 192c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32l0-32-320 0 0 32c0 17.7-14.3 32-32 32l-32 0c-17.7 0-32-14.3-32-32L0 256c0-26.7 16.4-49.6 39.6-59.2zM128 304a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm288 32a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>Racers Alex</h4>
          <p class="text-muted mb-0" id="date"></p>
        </div>
        <div class="date-picker">
          <input
            type="date"
            id="datePicker"
            class="form-control form-control-sm"
          />
        </div>
        <button
          id="toggleAllBtn"
          class="btn btn-sm btn-outline-primary d-none"
          type="button"
        >
          Expand All
        </button>
      </header>
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="mb-3">Overall Insights</h5>
          <div class="kpi-grid" id="kpi-grid"></div>
        </div>
      </div>
      <div class="card mb-3">
        <div class="card-body">
          <!-- <ul class="list-unstyled stats-list row gx-3" id="stats-list"></ul> -->
          <div class="row mt-4">
            <div class="col-md-6 mb-4 mb-md-0">
              <canvas id="solvedChart"></canvas>
            </div>
            <div class="col-md-6"><canvas id="avgTimeChart"></canvas></div>
          </div>
        </div>
      </div>
      <div class="card mb-3">
        <div class="card-body">
          <h5 class="mb-3">Additional Insights</h5>
          <div class="row">
            <div class="col-md-6 mb-4"><canvas id="scatterChart"></canvas></div>
            <div class="col-md-6"><canvas id="top5Chart"></canvas></div>
          </div>
        </div>
      </div>
      <!-- RACERS GRID -->
      <!-- <div class="racer-grid"></div> -->
    </div>
    <script src="./js/racercard.js" type="module"></script>
    <script src="./js/script.js" type="module"></script>

    <script type="module">
      import { generateRacersDashboard, getRacers } from "./js/script.js";
      const collapseEls = document.querySelectorAll(".collapse");
      const toggleBtn = document.getElementById("toggleAllBtn");
      //const rootStyle = getComputedStyle(document.documentElement);

      // Toggle all details
      toggleBtn.addEventListener("click", () => {
        const anyOpen = Array.from(collapseEls).some((el) =>
          el.classList.contains("show")
        );

        collapseEls.forEach((el) => {
          const instance = bootstrap.Collapse.getOrCreateInstance(el);
          anyOpen ? instance.hide() : instance.show();
        });
        toggleBtn.textContent = anyOpen ? "Expand All" : "Collapse All";
      });
      let datePicker = document.getElementById("datePicker");
      let url = new URL(window.location.href);
      let date = url.searchParams.get("date");
      date = date
        ? date
        : new Date().toLocaleDateString("en-CA", {
            timeZone: "America/Bogota",
          });
      datePicker.value = date;
      getRacers(date);
      datePicker.addEventListener("change", () => {
        let date = datePicker.value;
        getRacers(date);
      });
    </script>
  </body>
</html>
