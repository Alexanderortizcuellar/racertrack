<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Racers Dashboard ({{ date }})</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/style.css" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Custom Styles & Chart Color Variables -->
  </head>

  <body class="p-4" data-theme="light">
    <div id="dashboardContainer" class="container">
      <!-- HEADER -->
      <header
        class="d-flex flex-wrap justify-content-between align-items-center mb-5"
      >
        <div>
          <h1 class="dashboard-header mb-0">Racers Dashboard</h1>
          <p class="text-muted mb-0" id="date"></p>
        </div>
        <div class="date-picker">
          <input
            type="date"
            id="datePicker"
            class="form-control form-control-sm"
          />
        </div>
        <button
          id="toggleAllBtn"
          class="btn btn-sm btn-outline-primary"
          type="button"
        >
          Expand All
        </button>
      </header>
      <div class="card mb-5">
        <div class="card-body">
          <h4 class="mb-3">Overall Insights</h4>
          <ul class="list-unstyled stats-list row gx-3" id="stats-list">
          </ul>

          <div class="row mt-4">
            <div class="col-md-6 mb-4 mb-md-0">
              <canvas id="solvedChart"></canvas>
            </div>
            <div class="col-md-6"><canvas id="avgTimeChart"></canvas></div>
          </div>
        </div>
      </div>
      <div class="card mb-5">
        <div class="card-body">
          <h4 class="mb-3">Additional Insights</h4>
          <div class="row">
            <div class="col-md-6 mb-4"><canvas id="scatterChart"></canvas></div>
            <div class="col-md-6"><canvas id="top5Chart"></canvas></div>
          </div>
        </div>
      </div>
      <!-- RACERS GRID -->
      <!-- <div class="racer-grid"></div> -->
    </div>
    <script src="./js/racercard.js" type="module"></script>
    <script src="./js/script.js" type="module"></script>

    <script type="module">
      import { generateRacersDashboard, getRacers } from "./js/script.js";
      // script.js

      /*const racersData = [
        {
          date: "2024-10-12",
          id: 1,
          players: 4,
          puzzles: [
            {
              fen: "2r2rk1/6p1/4p2p/p2bN3/1q1P1p2/3Q1PnP/1PBB1bPK/2RR4 b - - 5 36",
              id: 1,
              lichess_id: "Aaerq",
              line: "b4d4 d3h7",
              racer_id: 1,
              rating: 1044,
              solved: true,
              time: 4,
            },
            {
              fen: "r1b2rk1/pp5p/2n1p1R1/8/8/4P3/PPQN1q1P/2K3R1 b - - 0 19",
              id: 2,
              lichess_id: "nbkrF",
              line: "h7g6 c2g6 g8h8 g6g7",
              racer_id: 1,
              rating: 1061,
              solved: true,
              time: 6,
            },
            {
              fen: "r1bq1rk1/ppp1bppp/2n2n2/8/2PpN3/1P1P2P1/PB1N1PBP/R2Q1RK1 b - - 3 15",
              id: 3,
              lichess_id: "BufAq",
              line: "c8g4 e4f6 e7f6 d1g4",
              racer_id: 1,
              rating: 1081,
              solved: true,
              time: 6,
            },
            {
              fen: "8/4k2p/p4pp1/1p2p3/1Pb1P2P/1r3P2/1n4P1/R3BBK1 b - - 6 35",
              id: 4,
              lichess_id: "EJ91e",
              line: "b2a4 f1c4 b5c4 a1a4",
              racer_id: 1,
              rating: 1093,
              solved: true,
              time: 9,
            },
            {
              fen: "2k1q2r/1p3p2/p1p2p2/2b2Nr1/3RP1P1/7P/PP4Q1/3R3K b - - 2 26",
              id: 5,
              lichess_id: "2tyiR",
              line: "c5d4 f5d6 c8d7 d6e8",
              racer_id: 1,
              rating: 1136,
              solved: false,
              time: 10,
            },
            {
              fen: "3r4/pR2kppp/4p3/2P5/2P3P1/P6P/8/4nK2 b - - 0 32",
              id: 6,
              lichess_id: "w7rtX",
              line: "d8d7 c5c6 d7b7 c6b7",
              racer_id: 1,
              rating: 1152,
              solved: false,
              time: 8,
            },
            {
              fen: "2r1r1k1/pq2ppb1/1p3np1/2p3Qp/7P/P1BP1NP1/1P2PP2/2R2RK1 b - - 8 21",
              id: 7,
              lichess_id: "jPoEl",
              line: "b7d5 c3f6 d5g5 f6g5",
              racer_id: 1,
              rating: 1185,
              solved: true,
              time: 17,
            },
            {
              fen: "r4rk1/1p2P1pp/p4n2/2bN4/7q/P7/1PP3PP/R2QR2K b - - 0 28",
              id: 8,
              lichess_id: "TAnB5",
              line: "f8e8 d5f6 g7f6 d1d5 g8g7 d5c5",
              racer_id: 1,
              rating: 1281,
              solved: true,
              time: 17,
            },
            {
              fen: "2k5/ppp1b2p/2b2p2/2qNpP2/1BN1P3/8/PPP3K1/3R1R2 b - - 4 25",
              id: 9,
              lichess_id: "GAtyP",
              line: "c5c4 d5e7 c8b8 d1d8",
              racer_id: 1,
              rating: 1311,
              solved: true,
              time: 7,
            },
            {
              fen: "r2qk2r/2p2ppp/p1nbpn2/1p1pN3/3P1B2/P1NQP3/1PP2PPP/R3K2R b KQkq - 2 10",
              id: 10,
              lichess_id: "nBGWY",
              line: "c6e5 d4e5 d6e5 f4e5",
              racer_id: 1,
              rating: 1326,
              solved: false,
              time: 7,
            },
          ],
          puzzles_done: 10,
          rank: 4,
          score: 17,
        },
        {
          date: "2024-10-12",
          id: 2,
          players: 3,
          puzzles: [
            {
              fen: "rnbq1b1r/ppp1k1pp/5n2/4Q3/2BPpB2/8/PPP2PPP/RN2K2R b KQ - 6 11",
              id: 11,
              lichess_id: "JFGha",
              line: "e7d7 e5e6",
              racer_id: 2,
              rating: 1030,
              solved: true,
              time: 5,
            },
            {
              fen: "r1b2Bk1/5ppp/3Rp3/1B2P3/4nP2/7P/1PP3P1/1K6 b - - 0 24",
              id: 12,
              lichess_id: "2zckX",
              line: "g8f8 d6d8 f8e7 d8e8",
              racer_id: 2,
              rating: 1036,
              solved: true,
              time: 11,
            },
            {
              fen: "4Rkr1/1p3p1p/p1rn1Bp1/8/5R2/4Q2P/1P3PPK/2q5 b - - 9 28",
              id: 13,
              lichess_id: "D6GTu",
              line: "d6e8 e3e7",
              racer_id: 2,
              rating: 1075,
              solved: true,
              time: 3,
            },
            {
              fen: "8/p5p1/2pKP1kp/8/P1P5/1P1P4/6b1/8 b - - 2 46",
              id: 14,
              lichess_id: "djebY",
              line: "g6f6 e6e7 f6f7 d6d7 g2h3 d7d8",
              racer_id: 2,
              rating: 1090,
              solved: true,
              time: 8,
            },
            {
              fen: "2b2k2/4bpp1/4p3/4q3/1P2BN2/4PQP1/7P/6K1 b - - 0 29",
              id: 15,
              lichess_id: "8AhNl",
              line: "e7b4 f4g6 f8g8 g6e5",
              racer_id: 2,
              rating: 1138,
              solved: true,
              time: 11,
            },
            {
              fen: "r1b1rk2/pp1np1bp/2p3p1/5pN1/2BP1B2/1P6/P1P2PPP/R3R1K1 b - - 5 16",
              id: 16,
              lichess_id: "vcwiT",
              line: "d7b6 g5h7",
              racer_id: 2,
              rating: 1164,
              solved: true,
              time: 6,
            },
            {
              fen: "rnb2rk1/5ppp/4p3/1P1p4/P1pP4/1q6/R3BPPP/1Q3RK1 b - - 2 20",
              id: 17,
              lichess_id: "H7CNB",
              line: "a8a4 b1b3 c4b3 a2a4",
              racer_id: 2,
              rating: 1171,
              solved: true,
              time: 11,
            },
            {
              fen: "2rq2rk/1b3ppp/p4P2/4p2N/2p1P1Qb/4B1RP/PP4P1/R5K1 b - - 0 26",
              id: 18,
              lichess_id: "UbEy1",
              line: "h4g3 f6g7 g8g7 g4g7",
              racer_id: 2,
              rating: 1275,
              solved: true,
              time: 11,
            },
            {
              fen: "b7/P3k2p/6p1/1Rp2p2/4n3/4K3/7P/8 b - - 0 56",
              id: 19,
              lichess_id: "3Fxkp",
              line: "e7d6 b5b8 d6c7 b8a8",
              racer_id: 2,
              rating: 1292,
              solved: true,
              time: 7,
            },
            {
              fen: "r4r2/1p3pkp/p1n1bNpB/2p5/8/P2P1N2/2PQ1PPP/b5K1 b - - 3 18",
              id: 20,
              lichess_id: "ljqiN",
              line: "g7f6 d2g5",
              racer_id: 2,
              rating: 1304,
              solved: true,
              time: 5,
            },
            {
              fen: "r1b1R3/pp4pk/8/3p1qB1/3p4/8/PP1Q1PPP/6K1 b - - 7 27",
              id: 21,
              lichess_id: "AGomM",
              line: "c8e6 e8a8 f5b1 d2c1",
              racer_id: 2,
              rating: 1323,
              solved: false,
              time: 10,
            },
            {
              fen: "3r1r1k/p2nq1pp/1p1N4/3BP3/5P2/2P4R/P3Q2P/6K1 b - - 2 29",
              id: 22,
              lichess_id: "L1WyA",
              line: "f8f4 h3h7 h8h7 e2h5",
              racer_id: 2,
              rating: 1411,
              solved: false,
              time: 2,
            },
          ],
          puzzles_done: 12,
          rank: 3,
          score: 20,
        },
        {
          date: "2024-10-12",
          id: 3,
          players: 5,
          puzzles: [
            {
              fen: "N1Q5/p4ppk/7p/8/5q2/2P4P/PP2r1P1/3R1Kn1 w - - 2 27",
              id: 23,
              lichess_id: "25Xd9",
              line: "f1g1 f4f2 g1h2 f2g2",
              racer_id: 3,
              rating: 1045,
              solved: true,
              time: 8,
            },
            {
              fen: "2kr1b1r/ppp5/1n2b1pp/8/4P3/P1N2N2/1Pn1KPPP/R1B2B1R w - - 1 18",
              id: 24,
              lichess_id: "eCEuv",
              line: "a1b1 e6c4",
              racer_id: 3,
              rating: 1060,
              solved: true,
              time: 8,
            },
            {
              fen: "7r/1p6/p6b/P1pNpk2/2P5/1P3P1K/6R1/8 w - - 3 39",
              id: 25,
              lichess_id: "NhTEb",
              line: "g2a2 h6f4 h3g2 h8h2",
              racer_id: 3,
              rating: 1065,
              solved: true,
              time: 11,
            },
            {
              fen: "1r4k1/pp3ppp/8/4rb2/8/2P1qB2/PP1R2PP/2KQ3R w - - 3 20",
              id: 26,
              lichess_id: "fUrTV",
              line: "h1e1 e3e1 d1e1 e5e1",
              racer_id: 3,
              rating: 1094,
              solved: true,
              time: 25,
            },
            {
              fen: "1QN5/8/4k3/P5p1/8/2K3P1/8/4q3 w - - 5 50",
              id: 27,
              lichess_id: "Zjazp",
              line: "c3b3 e1b1 b3c3 b1b8",
              racer_id: 3,
              rating: 1149,
              solved: true,
              time: 7,
            },
            {
              fen: "8/2k5/p7/6R1/P5p1/2P1NbP1/3r1K1P/8 w - - 3 43",
              id: 28,
              lichess_id: "FHcUt",
              line: "f2e1 d2e2 e1f1 e2e3",
              racer_id: 3,
              rating: 1171,
              solved: true,
              time: 11,
            },
            {
              fen: "R7/6kp/4ppp1/8/3P4/1P2PN1P/1q3PP1/6K1 w - - 4 29",
              id: 29,
              lichess_id: "7dV6o",
              line: "a8b8 b2c1 f3e1 c1e1",
              racer_id: 3,
              rating: 1189,
              solved: true,
              time: 11,
            },
            {
              fen: "1k3r2/1pp3bp/pq6/5Q2/8/1P1P3P/P1P3P1/1K1RR3 w - - 1 26",
              id: 30,
              lichess_id: "LldQi",
              line: "f5h7 b6d4 h7g7 d4g7",
              racer_id: 3,
              rating: 1273,
              solved: false,
              time: 9,
            },
          ],
          puzzles_done: 8,
          rank: 4,
          score: 17,
        },
        {
          date: "2024-10-13",
          id: 4,
          players: 8,
          puzzles: [
            {
              fen: "8/8/7p/5qk1/P4b1p/2P2P1P/1P2Q3/2K5 w - - 3 51",
              id: 31,
              lichess_id: "ocQHB",
              line: "c1d1 f5b1",
              racer_id: 4,
              rating: 1006,
              solved: true,
              time: 4,
            },
            {
              fen: "8/8/5p2/1R1N2p1/6Pp/5k2/r7/5K2 w - - 0 61",
              id: 32,
              lichess_id: "UDt8i",
              line: "d5f6 a2a1 b5b1 a1b1",
              racer_id: 4,
              rating: 1030,
              solved: true,
              time: 3,
            },
            {
              fen: "r4rk1/pb1qbp2/1p1p1npB/2p1pN2/3nP3/1B1P2Q1/PPP2PPP/RN3RK1 w - - 5 17",
              id: 33,
              lichess_id: "6GdzH",
              line: "h6f8 d4e2 g1h1 e2g3",
              racer_id: 4,
              rating: 1067,
              solved: false,
              time: 13,
            },
            {
              fen: "3q1r1k/1p2b1pp/2n5/2P1p2B/1P6/1Q1b4/5NPP/5R1K w - - 1 27",
              id: 34,
              lichess_id: "OSFv1",
              line: "f2d3 f8f1",
              racer_id: 4,
              rating: 1096,
              solved: false,
              time: 5,
            },
            {
              fen: "3r3k/p5p1/1q5p/1pp2N2/3n4/3Q1P2/PP4PP/1K1R4 w - - 2 32",
              id: 35,
              lichess_id: "Y1RiV",
              line: "d3e4 d4f5 d1d8 b6d8",
              racer_id: 4,
              rating: 1120,
              solved: true,
              time: 22,
            },
            {
              fen: "r4rk1/p5pp/1q6/3b4/4p1n1/2Q1B3/PP4PP/RN3R1K w - - 7 19",
              id: 36,
              lichess_id: "Bh8P3",
              line: "e3b6 f8f1 b6g1 g4f2",
              racer_id: 4,
              rating: 1127,
              solved: true,
              time: 10,
            },
            {
              fen: "rnbqkb1r/pp1p1ppp/4pn2/6B1/3p4/2P1P3/PP3PPP/RN1QKBNR w KQkq - 0 5",
              id: 37,
              lichess_id: "v9a8B",
              line: "c3d4 d8a5 b1d2 a5g5",
              racer_id: 4,
              rating: 1189,
              solved: true,
              time: 6,
            },
            {
              fen: "1k1r4/1p4p1/2p1B3/p2P2p1/P1P2rQ1/7P/3q4/2R1R2K w - - 11 42",
              id: 38,
              lichess_id: "1kKW8",
              line: "g4g5 f4f1 e1f1 d2g5",
              racer_id: 4,
              rating: 1274,
              solved: false,
              time: 20,
            },
          ],
          puzzles_done: 8,
          rank: 8,
          score: 10,
        },
      ];
      */
      const collapseEls = document.querySelectorAll(".collapse");
      const toggleBtn = document.getElementById("toggleAllBtn");
      //const rootStyle = getComputedStyle(document.documentElement);

      // Toggle all details
      toggleBtn.addEventListener("click", () => {
        const anyOpen = Array.from(collapseEls).some((el) =>
          el.classList.contains("show")
        );

        collapseEls.forEach((el) => {
          const instance = bootstrap.Collapse.getOrCreateInstance(el);
          anyOpen ? instance.hide() : instance.show();
        });
        toggleBtn.textContent = anyOpen ? "Expand All" : "Collapse All";
      });
      let datePicker = document.getElementById("datePicker");
      datePicker.addEventListener("change", () => {
        let date = datePicker.value;
        getRacers(date);
      });
    </script>
  </body>
</html>
